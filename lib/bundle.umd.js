!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).core=e()}(this,function(){"use strict";var n=(t.prototype.buildAssets=function(){var t=this.assetsSource,e=t.id,r=t.w,i=t.h,n=t.u,t=t.p;this.type="node",this.id=e,this.width=r,this.height=i,this.path=this.buildUrlPath(n,t)},t.prototype.buildUrlPath=function(t,e){return/base64/.test(e)?e:t?""+t+e:void 0},t);function t(t){this.assetsSource=t,this.buildAssets()}var a=function(){return(a=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function e(t,e){switch(t){case"o":return s=(o=e).a,o=o.k,!s&&"number"==typeof o;case"r":return a=(n=e).a,n=n.k,!a&&"number"==typeof n;case"p":return n=(a=e).a,a=a.k,!n&&Array.isArray(a);case"a":return i=(r=e).a,r=r.k,!i&&Array.isArray(r);case"s":return r=(i=e).a,i=i.k,!r&&Array.isArray(i)}var r,i,n,a,o,s}var l=4,c=.001,f=1e-7,y=10,h=11,p=1/(h-1),d="function"==typeof Float32Array;function i(t,e){return 1-3*e+3*t}function o(t,e){return 3*e-6*t}function b(t,e,r){return((i(e,r)*t+o(e,r))*t+3*e)*t}function m(t,e,r){return 3*i(e,r)*t*t+2*o(e,r)*t+3*e}function x(t){return t}function s(o,e,s,r){if(!(0<=o&&o<=1&&0<=s&&s<=1))throw new Error("bezier x values must be in [0, 1] range");if(o===e&&s===r)return x;for(var u=new(d?Float32Array:Array)(h),t=0;t<h;++t)u[t]=b(t*p,o,s);function i(t){for(var e=0,r=1,i=h-1;r!==i&&u[r]<=t;++r)e+=p;var n=e+(t-u[--r])/(u[r+1]-u[r])*p,a=m(n,o,s);return c<=a?function(t,e,r,i){for(var n=0;n<l;++n){var a=m(e,r,i);if(0===a)return e;e-=(b(e,r,i)-t)/a}return e}(t,n,o,s):0===a?n:function(t,e,r,i,n){for(var a,o,s=0;0<(a=b(o=e+(r-e)/2,i,n)-t)?r=o:e=o,Math.abs(a)>f&&++s<y;);return o}(t,e,e+p,o,s)}return function(t){return 0===t?0:1===t?1:b(i(t),e,r)}}function u(t,e){switch(t){case"o":return function(t){if(t.i&&t.o&&"object"==typeof t.o.x&&"object"==typeof t.i.x)return s(t.o.x[0],t.o.y[0],t.i.x[0],t.i.y[0])}(e);case"r":return function(t){if(t.i&&t.o&&"object"==typeof t.o.x&&"object"==typeof t.i.x)return s(t.o.x[0],t.o.y[0],t.i.x[0],t.i.y[0])}(e);case"p":return(r=e).o&&r.i?Array.isArray(r.o.x)&&Array.isArray(r.o.y)?s(r.o.x[0],r.o.y[0],r.i.x[0],r.i.y[0]):s(r.o.x,r.o.y,r.i.x,r.i.y):null;case"s":return function(t){if(t.i&&t.o&&"object"==typeof t.o.x&&"object"==typeof t.i.x)return s(t.o.x[0],t.o.y[0],t.i.x[0],t.i.y[0])}(e)}var r}function v(t){if(t.i&&t.o){var e=t.i,r=e.x,i=e.y,e=t.o,t=e.x,e=e.y;return Array.isArray(r)?"cube-bezier("+r[0]+", "+t[0]+", "+i[0]+", "+e[0]+")":"cube-bezier("+r+", "+t+", "+i+", "+e+")"}}var A=(r.prototype.buildOpacity=function(t){var e=t.layer,r=t.nextlayer,i=e.t,n=e.s,t=r||e,r=t.t,t=t.s;this.startTime=i,this.endTime=r,this.duration=r-i,this.startVal=this.getOpacity(n),this.endVal=this.getOpacity(t),this.bezierFn=u("o",e),this.bezierStr=v(e)},r.prototype.getOpacity=function(t){return Array.isArray(t)?Number(t[0]/100):Number(t/100)},r);function r(t){var e=t.layer,t=t.nextlayer;this.buildOpacity({layer:e,nextlayer:t})}var g=(S.prototype.buildRotate=function(t){var e=t.layer,r=t.nextlayer,i=e.t,n=e.s,t=r||e,r=t.t,t=t.s;this.startTime=i,this.endTime=r,this.duration=r-i,this.startVal=this.getRotate(n),this.endVal=this.getRotate(t),this.bezierFn=u("r",e),this.bezierStr=v(e)},S.prototype.getRotate=function(t){return Array.isArray(t)?Number(t[0]):Number(t)},S);function S(t){var e=t.layer,t=t.nextlayer;this.buildRotate({layer:e,nextlayer:t})}var j=(k.prototype.buildScale=function(t){var e=t.layer,r=t.nextlayer,i=e.t,n=e.s,t=r||e,r=t.t,t=t.s;this.startTime=i,this.endTime=r,this.duration=r-i,this.startVal=this.getScale(n),this.endVal=this.getScale(t),this.bezierFn=u("s",e),this.bezierStr=v(e)},k.prototype.getScale=function(t){if(Array.isArray(t))return[Number(t[0]/100),Number(t[1]/100),Number(t[2]/100)]},k);function k(t){var e=t.layer,t=t.nextlayer;this.buildScale({layer:e,nextlayer:t})}function F(t){var r=t.layer,t=t.frames,i=[];return r.forEach(function(t,e){i.push(new A({layer:t,nextlayer:e!==r.length-1?r[e+1]:null}))}),function(t,s){for(var u={},l=s.length,e=0;e<t;e++)!function(e){var t,r,i,n,a,o=s.filter(function(t){return t.startTime<=e&&t.endTime>e});o.length?(t=(n=o[0]).startTime,a=n.duration,r=n.startVal,i=n.endVal,o=n.bezierFn,n=n.bezierStr,a=Number(((e-t)/a).toFixed(2)),o?(o=o(a),u[e]={index:e,opacity:(i-r)*o+r,ease:n}):u[e]={index:e,opacity:(i-r)*a+r}):u[e]=0==e?{index:e,opacity:s[0].startVal}:{index:e,opacity:s[l-1].startVal}}(e);return u}(t,i)}function V(t){var r=t.layer,t=t.frames,i=[];return r.forEach(function(t,e){i.push(new g({layer:t,nextlayer:e!==r.length-1?r[e+1]:null}))}),function(t,s){for(var u={},l=s.length,e=0;e<t;e++)!function(e){var t,r,i,n,a,o=s.filter(function(t){return t.startTime<=e&&t.endTime>e});o.length?(t=(n=o[0]).startTime,a=n.duration,r=n.startVal,i=n.endVal,o=n.bezierFn,n=n.bezierStr,a=Number(((e-t)/a).toFixed(2)),o?(o=o(a),u[e]={index:e,rotate:(i-r)*o+r,ease:n}):u[e]={index:e,rotate:(i-r)*a+r}):u[e]=0==e?{index:e,rotate:s[0].startVal}:{index:e,rotate:s[l-1].startVal}}(e);return u}(t,i)}function O(t){var r=t.layer,t=t.frames,i=[];return r.forEach(function(t,e){i.push(new j({layer:t,nextlayer:e!==r.length-1?r[e+1]:null}))}),function(t,y){for(var h={},p=y.length,e=0;e<t;e++)!function(e){var t,r,i,n,a,o,s,u,l,c,f=y.filter(function(t){return t.startTime<=e&&t.endTime>e});f.length?(a=(n=f[0]).startTime,o=n.duration,t=n.startVal,s=n.endVal,r=n.bezierFn,i=n.bezierStr,n=r(f=Number(((e-a)/o).toFixed(2))),a=s[0]-t[0],o=s[1]-t[1],s=s[2]-t[2],r?(u=a*n+t[0],l=o*n+t[1],c=s*n+t[2],h[e]={index:e,scale:[u,l,c],ease:i}):(u=a*f+t[0],l=o*f+t[1],c=s*f+t[2],h[e]={index:e,scale:[u,l,c]})):h[e]=0==e?{index:e,scale:y[0].startVal}:{index:e,scale:y[p-1].startVal}}(e);return h}(t,i)}var T=(w.prototype.buildBaseInfo=function(t){var e=t.ind,t=t.refId;this.index=e,this.id=t,this.attributes={},this.animeFrames=[]},w.prototype.buildAnimeLayer=function(t){var r=this,i=t.ks;Object.keys(i).forEach(function(t){var e=i[t];r.buildMetricAnime(t,e)})},w.prototype.buildMetricAnime=function(t,e){switch(t){case"o":this.buildOpacityAnime(e);break;case"r":this.buildRotateAnime(e);break;case"p":this.buildPositionAnime(e);break;case"a":this.buildAnchorAnime(e);break;case"s":this.buildScaleAnime(e)}},w.prototype.buildOpacityAnime=function(t){e("o",t)?this.attributes.opacity=this.getOpacityStyle(t.k):(t=F({layer:t.k,frames:this.frames}),this.buildAnimeFrames(t))},w.prototype.buildRotateAnime=function(t){e("r",t)?this.attributes.rotate=this.getRotateStyle(t.k):(t=V({layer:t.k,frames:this.frames}),this.buildAnimeFrames(t))},w.prototype.buildPositionAnime=function(t){e("p",t)&&(this.attributes.position=this.getPositionStyle(t.k))},w.prototype.buildAnchorAnime=function(t){e("a",t)&&(this.attributes.anchor=this.getAnchorStyle(t.k))},w.prototype.buildScaleAnime=function(t){e("s",t)?this.attributes.scale=this.getScaleStyle(t.k):(t=O({layer:t.k,frames:this.frames}),this.buildAnimeFrames(t))},w.prototype.getOpacityStyle=function(t){return Number(t/100)},w.prototype.getRotateStyle=function(t){return Number(t)},w.prototype.getPositionStyle=function(t){return[t[0],t[1],t[2]]},w.prototype.getAnchorStyle=function(t){return[t[0],t[1],t[2]]},w.prototype.getScaleStyle=function(t){return{x:Number(t[0]/100),y:Number(t[1]/100),z:Number(t[2]/100)}},w.prototype.getId=function(){return this.id},w.prototype.buildAnimeFrames=function(r){var i=this;Object.keys(r).forEach(function(t){var e=i.animeFrames[t]||{};i.animeFrames[t]=a(a({},e),r[t])})},w);function w(t){var e=t.layer,t=t.frames;this.frames=t,this.buildBaseInfo(e),this.buildAnimeLayer(e)}function z(t){t=t.json;this.json=t,this.buildBaseInfo(),this.buildWrapperInfo(),this.buildAssets(),this.buildLayers()}return z.prototype.buildBaseInfo=function(){var t=this.json,e=t.nm,r=t.ip,i=t.op,t=t.fr;this.name=e,this.startframe=r,this.endframe=i,this.frame=t,this.layer={},this.assetsObj={}},z.prototype.buildWrapperInfo=function(){var t=this.json,e=t.w,t=t.h;this.layer={type:"node",width:e,height:t,children:[],layer:{}}},z.prototype.buildAssets=function(){var r=this,t=this.json.assets,i=[];t.forEach(function(t){var e=new n(t);i.push(e),r.assetsObj[t.id]=e}),this.layer.children=i},z.prototype.outputJson=function(){return{name:this.name,startframe:this.startframe,endframe:this.endframe,frame:this.frame,layer:this.layer}},z.prototype.buildLayers=function(){var r,i=this,t=this.json.layers;t&&t.length&&(r=this.endframe-this.startframe+1,t.forEach(function(t){var e=new T({layer:t,frames:r<i.frame+1?i.frame+1:r}),t=e.getId();i.assetsObj[t].layer=e}))},z});
